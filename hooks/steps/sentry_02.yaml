---
- name: ARTACK | sentry | finalize release
  command: "sentry-cli releases finalize {{ artack_sentry_release }}"
  when: not artack_sentry_release_existing
  run_once: true
  delegate_to: 127.0.0.1

- name: ARTACK | sentry | set commits to the release
  command: "sentry-cli releases set-commits {{ artack_sentry_release }} --commit '{{ artack_sentry_repo }}@{{ ansistrano_git_result.after }}'"
  run_once: true
  delegate_to: 127.0.0.1
#  --url https://bitbucket.artack.ch/projects/{{ artack_sentry_bitbucket_project }}/repos/{{ artack_sentry_bitbucket_repo }}/commits/{{ ansistrano_git_result.after }}
-
- name: ARTACK | sentry | get deploy time end
  set_fact:
    artack_sentry_deploy_time_end: "{{ lookup('pipe', 'date +%s') }}"
  run_once: true
  delegate_to: 127.0.0.1

- name: ARTACK | sentry | add deploy to the release
  command: "sentry-cli releases deploys {{ artack_sentry_release }} new --env {{ artack_sentry_environment }} --started {{ artack_sentry_deploy_time_start }} --finished {{ artack_sentry_deploy_time_end }}"
  run_once: true
  delegate_to: 127.0.0.1

